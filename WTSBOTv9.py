import praw
import config
import time
import os
import requests
import re
import traceback

from datetime import datetime

startTime = datetime.utcnow()

list_of_names = ["phylogenizer", "merlyn923", "unknown_name", "lego_c3po", "thechuck42", "shrike1978", "brecka", "valentineblacker", "smolderingdesigns", "mystimel",
                 "themadflyentist", "so_then_i_said", "drillbit7", "mooingtricycle", "kropserkel", "girlpirate", "heterodonplatirhinos", "squamate_enthusiast_", "fairlyorange", "jesse-2003v2", "geologisttop3186", "nmherping", "pmassare", "serpentarian", "dancinghysteria", "holyshitbears", "im_lightmare", "dipsadinae", "herpetologissst", "thesis_ascendant", "plexicle", "daddylongtits", "pbounds2","herpetotime", "theyshootbeesatyou", "xiolezine", "poofmoof1", "abks", "falconsnakecat786", "za_snake_guy", "bahandgah"]
sig = "*I am a bot created for /r/whatsthissnake, /r/snakes and /r/herpetology to help with snake identification and natural history education. You can find more information, including a comprehensive list of commands, " \
      "[here](https://www.reddit.com/r/whatsthissnake/comments/flh548/phylobot_v07_information_and_patch_notes_bot_info/) report problems " \
      "[here](https://www.reddit.com/message/compose/?to=Phylogenizer) and if you'd like to buy me a coffee or beer, you can do that  " \
      "[here](https://www.buymeacoffee.com/SEBPhyloBotWTS).*"

commands = [
	{'command': "deadsnake", 'text': "Please don't kill snakes - they are a natural part of the ecosystem and [even species that use venom for prey acquisition and defense are beneficial to humans](https://web.archive.org/web/20180802190346/https://umdrightnow.umd.edu/news/timber-rattlesnakes-vs-lyme-disease). One cannot expect outside to be sterile - if you see a snake you're probably in or around their preferred habitat. Most snakes are legally protected from collection, killing or harassment as non-game animals at the state level.\n\n[Neighborhood dogs](http://livingalongsidewildlife.com/?p=3141) are more likely to harm people. Professional snake relocation services are often free or inexpensive, but snakes often die trying to return to their original home range, so it is usually best to enjoy them like you would songbirds or any of the other amazing wildlife native to your area. Commercial snake repellents are not effective - to discourage snakes, eliminate sources of food and cover; clear debris, stacked wood and eliminate rodent populations. Seal up cracks in and around the foundation/base of your home."},
	{'command': "myths", 'text': "Here is a list of common myths and misconceptions about snakes. The below statements are false:\n\n[Non-venomous snakes shake their tails to mimic rattlesnakes](https://www.davidpfenniglab.com/wp-content/uploads/2019/10/2016_Am-Nat.pdf)\n\n[Baby venomous snakes are more dangerous than adults](https://web.archive.org/web/20120922054435/http://www.livingalongsidewildlife.com/2009/10/are-bites-from-baby-venomous-snakes.html#comment-1039213912)\n\n[Snakes Chase People](https://www.youtube.com/watch?v=314N7xIeRR8)\n\n[Rattlesnakes are losing their rattle because of {insert reason}](https://web.archive.org/web/20111227034153/http://www.livingalongsidewildlife.com/2011/06/are-rattlesnakes-rattling-less-because.html)\n\n[The only good snake is a dead snake](https://umdrightnow.umd.edu/news/timber-rattlesnakes-vs-lyme-disease)"},
	{'command': "poisonous", 'text': "The verbiage currently used in biology is 'venom is injected poison is ingested'. So snakes with medically significant venom are typically referred to as venomous, but some species are also poisonous. Old books will use poisonous or 'snake venom poisoning' but that has fallen out of favor." +"\n\n" +"The best examples of poisonous snakes are *Rhabdophis* snakes from east Asia that [sequester and release toxins from their frog diet in nuchal glands in the neck](http://www.pnas.org/content/pnas/104/7/2265.full.pdf)."},
	{'command': "venomous", 'text': "Snakes with medically significant venom are typically referred to as venomous, but some species are also poisonous. Old media will use poisonous or 'snake venom poisoning' but that has fallen out of favor. Venomous snakes are important native wildlife, and are not looking to harm people, so can be enjoyed from a distance. If found around the home or other places where they are to be discouraged, a squirt from the hose or a gentle sweep of a broom are usually enough to make a snake move along. Do not attempt to interact closely with or otherwise kill venomous snakes without proper safety gear and training, as bites occur mostly during these scenarios. Wildlife relocation services are free or inexpensive across most of the world." +"\n\n"+ "If you are bitten by a venomous snake, contact emergency services or otherwise arrange transport to the nearest hospital that can accommodate snakebite. Remove constricting clothes and jewelry and remain calm. A bite from a medically significant snake is a medical emergency, but not in the ways portrayed in popular media. Do not make any incisions or otherwise cut tissue. Extractor and other novelty snakebite kits are not effective and can cause damage worse than any positive or neutral effects."},
	{'command': "keels" or "keeled", 'text': "Keels are raised lines on the surface of scales that can be used as a character in snake identification to quickly narrow down options or distinguish between some similar looking species. Strength of keel is variable; usually referred to as 'strong' vs 'weak'.\n\nYou can read more about snake color patterns and scale architecture [here](https://www.floridamuseum.ufl.edu/herpetology/fl-snakes/color-pattern/)."},
	{'command': "cats", 'text': "Everyone loves cats, but they belong indoors. Each year in the United States [free-ranging domestic cats kill 1.3-4.0 billion birds and 6.3-22.3 billion mammals](https://www.nature.com/articles/ncomms2380.pdf). Numbers for reptiles are similar in Australia, as [2 million reptiles are killed **each day** by cats, totaling 650 million a year](https://www.researchgate.net/profile/Brett_Murphy/publication/325787707_How_many_reptiles_are_killed_by_cats_in_Australia/links/5b317b20aca2720785e837f1/How-many-reptiles-are-killed-by-cats-in-Australia.pdf). Outdoor cats are directly responsible for the extinction of at least 33 species worldwide and are considered one of the biggest threats to native wildlife. Keeping cats indoors is also better for them and public health - cats with outdoor access live shorter lives and are [2.77 times more likely to carry infectious pathogens](http://wilsonlab.com/publications/2019_BioLetters_Chalkowski_et_al.pdf)."},
	{'command': "shed", 'text': "Snakes are identifiable from intact shed skins, but it takes some time and the correct knowledge.\n\nIf you're in North America, a basic guide to shed identification can be found [here](http://snakesarelong.blogspot.com/2012/11/identifying-snake-sheds-part-iii.html), but the people of /r/whatsthissnake will help if you post clear photos of the head, vent and midbody. \n\n Get a clear, focused photo of the complete dorsal surface ([like this](https://4.bp.blogspot.com/-iuEVOu2oO9M/UJ6X2U6hckI/AAAAAAAAMQo/sHFveKzsAhA/s1600/dorsal+scale+rows+KJ.png)) about 1/3 of the way down the body so we can count scale rows and see the pattern, scale texture, and other details. This may be easiest if you cut out a section, then cut through the middle of the belly scales. If present, also get a clear, focused photo of the anal plate ([like this](https://3.bp.blogspot.com/-I-bmJVGVARw/UJ6JQYFasMI/AAAAAAAAMO8/sV8ZOBQOCEQ/s1600/Fullscreen+capture+8252012+124346+PM.bmp.jpg))."},
	{'command': "gluetrap" or "gluetraps", 'text': "While effective in some applications, glue traps generally shouldn't be used outside or in garages, as by-catch of snakes and other harmless animals is difficult to avoid.\n\nSnakes stuck to glue traps are not always a lost cause and can be removed with mild cooking oil such as olive oil or lard. While applying more oil as you go, slowly and gently start with the tail and work your way forward. This should not be attempted by a novice on a venomous snake. Remember to use caution even with nonvenomous species - these animals do not understand your good intentions and will be exhausted, dehydrated and scared. They may try to bite you or themselves in self defense. This advice also applies to many common tape adhesives."},
	{'command': "resources", 'text': "There are a number of resources for snake ID and this list is nowhere near comprehensive.\n\nGlobally, comprehensive species lists are available via Reptile Database [Advanced Search](http://reptile-database.reptarium.cz/advanced_search). Reptile Database is mostly correct and up to date in terms of taxonomy. Another worldwide resource is [Snakes of the World](https://www.crcpress.com/Snakes-of-the-World-A-Catalogue-of-Living-and-Extinct-Species/Wallach-Williams-Boundy/p/book/9781138034006) which, in addition to being comprehensive for extant snakes, also provides a wealth of information on fossil taxa.\n\nRegional guides are useful. If you're in North America, the [Eastern Peterson Guide](https://www.amazon.com/Peterson-Reptiles-Amphibians-Eastern-Central/dp/0544129970) and [Western Peterson Guide](https://www.amazon.com/Peterson-Western-Reptiles-Amphibians-Fourth/dp/1328715507) are great tools, as is [Snakes of the United States and Canada](https://www.amazon.com/Snakes-United-States-Canada-Ernst/dp/1588340198). While [plagiarized and problematic](https://www.researchgate.net/profile/Joseph_Mendelson_Iii/publication/311993684_Review_of_Snakes_of_Mexico_volume_P_Heimes_author_by_J_R_Mendelson/links/5867e32c08ae329d620dfb40/Review-of-Snakes-of-Mexico-volume-P-Heimes-author-by-J-R-Mendelson.pdf), the book [Snakes of Mexico](https://www.amazon.com/Herpetofauna-Mexicana-Vol-Peter-Heimes/dp/389973100X) is the best easily accessible information for the region. For Central America, the [Kohler](https://www.amazon.com/Reptiles-Central-America-REVISED-2008/dp/3936180288) book as well as [Savage's Costa Rica book](https://www.amazon.com/Amphibians-Reptiles-Costa-Rica-Herpetofauna-dp-0226735389/dp/0226735389/) are excellent resources. South America is tough but has [a diagnostic catalog](https://www.biodiversitylibrary.org/page/7868973). Australia has [Cogger](https://www.publish.csiro.au/book/7845/) as a herp bible. SE Asia has two guides [one in German](https://www.amazon.com/Amphibien-Reptilien-S%C3%BCdostasiens-Wolfgang-Grossmann/dp/3931587126) and one [comprehensive](https://www.nhbs.com/a-field-guide-to-the-reptiles-of-south-east-asia-book). For Europe, you simply can't get better than the three volumes of [Handbuch der Reptilien und Amphibien Europas](https://www.nhbs.com/handbuch-der-reptilien-und-amphibien-europas-band-3i-schlangen-serpentes-i-book). Africa is also difficult - no comprehensive guide exists but there are a few good regional guides like [Reptiles of East Africa](https://www.amazon.com/Field-Guide-Reptiles-East-Africa/dp/0713668172/) and [Guide to the Reptiles of Southern Africa](https://www.amazon.com/Guide-Reptiles-Southern-Africa/dp/1770073868/). [Amphibians and Reptiles of Madagascar](https://www.amazon.com/Field-Guide-Amphibians-Reptiles-Madagascar/dp/392944903X) is a good source for that distinct region. For the Indian subcontinent, use [Snakes of India](https://www.amazon.com/Snakes-India-Field-Romulus-Whitaker/dp/8190187309/) \n\nRemember, species names are hypotheses that are tested and revised - old books become dated by the nature of science itself. One of your best resources is going to be following /r/whatsthissnake, or (for North America) with the [SSAR Standard Names List](https://ssarherps.org/cndb/) for the most recent accepted taxonomic changes.\n\n[Here](https://imgur.com/a/JDW7fBz) is an example of a small personal herpetology library."},
	{'command': "location", 'text': "Some species are best distinguishable from each other by geographic range, and not all species live all places. Providing a rough geographic location like county or closest city allows for quicker, accurate identification. Thanks!"},
	{'command': "blackrat", 'text': "Black Ratsnake is a common name for a color pattern shared by three different species of *Pantherophis* ratsnake across the northern portion of their range.\n\n The black ratsnake species complex, formerly *Elaphe obsoleta*, underwent revision in 2001-2002 from multiple authors and received three main changes from 2000 to now. First, the complex was delimited in [Burbrink 2001](https://onlinelibrary.wiley.com/doi/pdf/10.1111/j.0014-3820.2000.tb01253.x) based on what were then modern molecular methods, where three distinct lineages were uncovered that did not reflect previous subspecies designations. Each of the three geographically partitioned taxa were elevated to full species status, and subspecies were discarded. The polytypic color patterns in these species are most likely under strong selection by the local environment and don't reflect evolutionary history. Where species intersect and habitat converges, color pattern also converges, leaving these species nearly morphologically indistinguishable to the naked eye. Second, using *Elaphe* as a genus name wasn't the best way to reflect phylogenetic history, so the genus *Pantherophis* was adopted for new world ratsnakes in [Utiger 2002](http://www.sierraherps.com/pdf/Utiger%20et%20al_2002.pdf). Remember, species names are hypotheses that are tested and revised. While the analyses published in 2001 are strong and results are geographically similar in other taxa, these species were investigated further using genomic data, and in 2020 the authors [released an update](https://onlinelibrary.wiley.com/share/author/PBAKUNF4XZI2ND5TIWHK?target=10.1111/evo.14141), clarifying ranges, filling in grey zones and confirming three distinct species.\n\n Third, clarity in range and type specimens necessitated the need to fix lineage names in line with taxonomic rules called the 'principle of priority'. The four currently accepted species in this complex as of October 2021 are Baird's Ratsnake *Pantherophis bairdi*, Western Ratsnake *Pantherophis obsoletus*, Central Ratsnake *Pantherophis alleghaniensis* and Eastern Ratsnake *Pantherophis quadrivittatus*. \n\n The experts on this group offer this summary [from their 2021 paper](https://www.dropbox.com/s/m7ru46gyhtq2hyz/HR_Sept_2021_150dpi_PointsOfView.pdf?dl=1): \n\n >For the ratsnakes in particular, given the overtly chaotic and unsubstantiated basis of their taxonomy in the late 1990s, Burbrink et al. (2000) endeavored to test this taxonomic hypothesis (sensu Gaston and Mound 1993). This also provided an empirical observation of geographic genetic variation (then an unknown quantity) as an act of phylogenetic natural history (sensu Lamichhaney et al. 2019). Their analyses rejected the existing taxonomy as incompatible with the estimated evolutionary history of the group, ending a paradigm that was at least 48 years old from Dowling (1952) with respect to the non-historical subspecies definitions. Subsequently, Burbrink (2001) conducted an explicit taxonomic revision based on both mitochondrial and multivariate morphological analyses in an integrative taxonomy. The limitations of these data (scale counts, mensural measurements, and maternally inherited DNA) produced a zone of potential taxonomic uncertainty, while nonetheless allowing for significant statistical phenotypic discrimination between the geographic genetic lineages. Thus, based on the best possible evidence and interpretation at the time, the now-falsified historical taxonomic arrangement of subspecies definitions was replaced with an explicitly phylogenetic, lineage-based species-level taxonomy derived from the estimated evolutionary history of the group. The persistence of some remaining uncertainty is a natural and expected outcome in all scientific investigations, as we can never have complete data or perfect knowledge of a system. Twenty years later, Burbrink et al. (2021) more than tripled the number of individuals sampled, increased the number of loci used by 2491 times, and thus clarified the remaining fuzziness associated with the potential zone of taxonomic uncertainty. They revealed this uncertainty to be a complex hybrid zone with varying degrees of admixture. This had the additional effect, as described above, of redefining the allocation of type localities and valid names, and thus the taxonomic proposal here represents the best present-day resolution of nomenclature in the group, in accordance with our understanding of its evolutionary history. As science progresses, even this may change in the future with new whole genome datasets or interpretations of phylogeographic lineage formation and phylogenetic species concepts. These conclusions may be unsettling to those that wish to retain taxonomies generated from data and assumptions about species and subspecies made in the 19th and 20th century. However, we question the social and scientific utility of any insistence on recognizing clearly falsified, non-historical arrangements based solely on the burden of heritage in taxonomic inertia (see Pyron and Burbrink 2009b). \n\n [Range Map](http://snakeevolution.org/rangemaps/ratrangereduced.jpg)"},
	{'command': "cottonwater", 'text': "There are few things that can help differentiate between cottonmouths (*A. piscivorus*, *A. conanti*) and harmless water snakes (*Nerodia* spp.) once you learn to recognize them properly.  It's important to try to **apply as many keys as possible**; the more of these characteristics you can accurately identify, the more reliable your ID will be.  Underlined text links to pictures to help illustrate the keys." +"\n\n"+ "1. Cottonmouths have a prominent, angular ridge along the top of the head, starting around the supraocular scale (directly above the eye) and running forward toward the snout ([side view](https://www.flickr.com/photos/francisg/781633459/), [front view](https://www.flickr.com/photos/dfc_pcola/46159931261/)).  This ridge protrudes outward, partially overhanging the eye like a brow, and gives the snake an annoyed or [grumpy looking appearance](https://www.inaturalist.org/observations/21784039).  This also partially obscures the eyes when viewed [from above](https://www.flickr.com/photos/jlyn_nature/11922670356/).  In water snakes, the supraocular scale does not overhang the eye, giving the animal a 'derpy' appearance [from the side](https://www.flickr.com/photos/sdrimagestore/19767032301/) or [head on](https://www.inaturalist.org/observations/31181955), and allows you to see most of the eye [from above](https://www.inaturalist.org/observations/49688336)." +"\n\n"+ "2. Cottonmouths have white or cream colored horizontal stripes or lines that run from [below the eye toward the corner of the mouth](https://www.flickr.com/photos/31766129@N08/38793934210/), and often another that runs from [behind the top of the eye toward the point of the jaw](https://www.flickr.com/photos/mirarr/32197116634/).  Water snakes do not." +"\n\n"+ "3. Water snakes usually have [dark, vertical bars](https://www.flickr.com/photos/42389547@N00/4690698138/in/photolist-89v48Q-85DUpz) along the [edges of their labial scales](https://www.flickr.com/photos/144305930@N07/48800934783/).  Cottonmouths do not." +"\n\n"+ "4. Cottonmouths and water snakes both darken with age, and the pattern is often obscured by the time they reach adulthood.  When the dorsolateral pattern IS visible, cottonmouths have bands that are usually wider at the bottom than on top; like pyramids in [side view](https://www.inaturalist.org/observations/50503400), or hourglasses [from above](https://www.inaturalist.org/observations/5477628).  In some individuals, the bands might be [broken](https://www.inaturalist.org/observations/20863027) or [incomplete](https://www.inaturalist.org/observations/43217641), so this is not 100% diagnostic, but is still useful when used in conjunction with the other keys.  Water snakes exhibit a wide variety of patterns; most species aren't banded at all, and the ones that are banded have bands that are wider at the top, like [upside down triangles](https://www.flickr.com/photos/57809070@N03/10789857605/)." +"\n\n"+ "5. Adult cottonmouths often have a [noticeable dorsal ridge](https://www.inaturalist.org/observations/41856310) along the vertebrae. This gives the body a [triangular appearance](https://www.flickr.com/photos/andrewtheus/11110609634/in/photostream/) in cross-section, which is especially noticeable in [underweight](https://www.inaturalist.org/observations/20202718) or dehydrated animals, or when they initiate a [defensive display](https://www.flickr.com/photos/42272247@N07/21578345566/).  Water snakes, by contrast, are more cylindrical in cross-section." +"\n\n"+ "6. Baby cottonmouths are born with [yellow or greenish tail tips](https://www.flickr.com/photos/josiah_townsend/4385588894/in/photostream/) (used to lure small prey) that fade as they age.  Young water snakes do not have these ([baby *N. sipedon*](https://www.flickr.com/photos/41710899@N08/8760068810/), [baby *N. rhombifer*](https://www.flickr.com/photos/kaptainkory/30707198771/in/photostream/) for comparison)." +"\n\n"+ "7. Adult water snakes are fairly heavy-bodied, but cottonmouths of similar length tend to be significantly stouter. /n/n There are also some notable behavioral differences.  Water snakes often bask in branches and bushes overhanging water; this is uncommon in cottonmouths.  It is also true that water snakes often swim with the [body partially submerged](https://www.flickr.com/photos/100108154@N02/25613846737/), while cottonmouths usually swim with the [head held high and much of the body above the water line](https://www.inaturalist.org/observations/50503400), but you can't rely on this characteristic alone; **each are fully capable of swimming the other way** and sometimes do so.  Water snakes are more likely than cottonmouths to dive underwater to escape danger.  When approached, water snakes are more likely to rapidly flee, whereas cottonmouths are more likely to slowly crawl away or simply stay still and hope not to be noticed.  If approached closely or cornered, water snakes are more likely to [flatten out their heads](https://www.flickr.com/photos/usfws_pacificsw/27564085765/in/photostream/) and/or [bodies](https://www.flickr.com/photos/91005472@N07/8494553139/) to appear larger and/or strike in the general direction of the person/animal they are cornered by, hoping to create enough space to escape.  Cottonmouths, on the other hand, are more likely to tilt their heads back (to a near vertical angle) and gape their mouths open, [displaying the white lining of the mouth](https://www.flickr.com/photos/169268909@N03/45916257755/) as a threat display, and vibrate their tails." +"\n\n"+ "Bonus: two separate sets of cottonmouths [preying upon water snakes](https://www.inaturalist.org/observations/44447911) that allow direct comparisons between [similarly sized animals](https://www.inaturalist.org/observations/45546782), plus a picture of a [juvenile cottonmouth (bottom left)](https://www.flickr.com/photos/kaptainkory/6661143685/) with a juvenile common water snake (top) and a juvenile plain-bellied water snake (bottom right)."},
	{'command': "wildpet" or "wildpets", 'text': "Please leave wild animals in the wild. This includes not purchasing common species collected from the wild and sold cheaply in pet stores or through online retailers, like *Thamnophis* Ribbon and Gartersnakes, *Opheodrys* Greensnakes, *Xenopeltis* Sunbeam Snakes and *Dasypeltis* Egg-Eating Snakes. Brownsnakes *Storeria* found around the home do okay in urban environments and don't need 'rescue'; the species typically fails to thrive in captivity and should be left in the wild. Reptiles are kept as pets or specimens by many people but captive bred animals have much better chances of survival, as they are free from parasite loads, didn't endure the stress of collection and shipment, and tend to be species that do better in captivity. Taking an animal out of the wild is not ecologically different than killing it, and most states protect non-game native species - meaning collecting it probably broke the law.  Source captive bred pets and be wary of people selling offspring dropped by stressed wild-caught females collected near full term as 'captive bred'." +"\n\n" + "High-throughput reptile traders are collecting snakes from places like Florida with lax wildlife laws with little regard to the status of fungal or other infections, spreading them into the pet trade. In the other direction, taking an animal from the wild, however briefly, exposes it to domestic pathogens during a stressful time. Placing a wild animal in contact with caging or equipment that hasn't been sterilized and/or feeding it food from the pet trade are vector activities that can spread captive pathogens into wild populations. Snake populations are undergoing heavy decline already due to habitat loss, and [rapidly emerging](https://esajournals.onlinelibrary.wiley.com/doi/pdfdirect/10.1002/ecs2.3153) pathogens [are being documented](https://onlinelibrary.wiley.com/doi/full/10.1002/ece3.3557) in wild snakes that were introduced by snakes from the pet trade." +"\n\n" + "If you insist on keeping a wild pet, it is your duty to plan and provide the correct veterinary care, which often is two rounds of a pair of the 'deworming' medications Panacur and Flagyl and injections of supportive antibiotics. This will cost more than enough to offset the cheap price tag on the wild caught animal at the pet store or reptile show and increases chances of survival past about 8 months, but does not offset removing the animal from the wild."},
	{'command': "aggressive" or "defensive", 'text': "Snakes aren't known for 'aggression' or 'territoriality' but have developed impressive defensive anti-predator displays. Striking, coiling, hissing and popping are all defensive behaviors. The first line of defense in snakes is typically to hold still and rely on camouflage, or flee. Some species will move past people to get away - sometimes interpreted as 'chasing'. Cottonmouth snakes *Agkistrodon piscivorus* and *A. conanti* are among some species that may [aggressively flee](http://ufwildlife.ifas.ufl.edu/pdfs/Cottonmouth%20attack.pdf), but if you leave a safe distance between yourself, any snake and the snake's intended destination, there is no reason to expect to experience it."},
	{'command': "headshape", 'text': "Head shape is not a reliable indicator of if a snake has medically significant venom. Nonvenomous snakes commonly flatten their heads to a triangle shape in defensive displays, and some elapids like coralsnakes have elongated heads. It's far more advantageous to familiarize yourself with venomous snakes in your area through photos and field guides or by following subreddits like /r/whatsthissnake than it is to try to apply any generic trick."},
    {'command': "pupils", 'text': "Pupil shape should not be used in determining the presence of medically significant venom. Not only are there many venomous elapids with round pupils, there are many harmless snakes with slit pupils, such as [*Hypsiglena sp.* Nightsnakes](https://www.coloradosnakes.com/uploads/9/7/8/6/9786261/2776219_orig.jpg), [*Leptodeira sp.* Cat-eyed Snakes](https://previews.123rf.com/images/kjwells86/kjwells861802/kjwells86180200159/95840105-a-northern-cat-eyed-snake-leptodeira-septentrionalis-up-close-at-night-in-belize-.jpg), and even some common pet species such as [Ball Pythons](https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/ba8eedc2-f544-4e9f-aa0b-dc2e773a013d/d2a6s0e-a355d8dc-a8f3-452f-aad8-d199f1c1a15f.jpg?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcL2JhOGVlZGMyLWY1NDQtNGU5Zi1hYTBiLWRjMmU3NzNhMDEzZFwvZDJhNnMwZS1hMzU1ZDhkYy1hOGYzLTQ1MmYtYWFkOC1kMTk5ZjFjMWExNWYuanBnIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0.f3Er8L48O5xkZjpnufyvhj74QqCoASklxjPKdRRVeq4)."  +"\n\n"+ "Furthermore, when eyes with slit pupils are dilated by low light or a stress response, the pupils will be round. As an example, while [Copperheads have slit pupils](https://d.newsweek.com/en/full/1628192/copperhead-snakes.jpg?w=1600&h=1200&l=72&t=40&q=88&f=cc296cc3e18d1641ec0c180e07c516e4), when dilated [the pupils will appear round](https://d1ti4rb4parwcs.cloudfront.net/monthly_2017_05/12879241333_6b5499a58e_z.thumb.jpg.1d01a9e58ee44c3e8399aa0c1deb837d.jpg)."  +"\n\n"+ "Slit pupils are associated primarily with nocturnal behavior in animals, as they offer sensitivity to see well in low light while providing the ability to block out most light during the day that would otherwise overwhelm highly sensitive receptors. Slit pupils may [protect from high UV](https://brill.com/view/journals/ctoz/84/1/article-p1_1.xml?language=en) in [eyes that lack UV filters in the lens](https://academic.oup.com/mbe/article/33/10/2483/2925599?login=false). These functions are decoupled from the use of venom in prey acquisition and are present in many harmless species."},
     {'command': "fiveline", 'text': "The body plan of 'small skink with bright blue tail and yellow lines' is [adaptive](https://reptile-database.reptarium.cz/species?genus=Plestiodon&species=elegans) [around](https://reptile-database.reptarium.cz/species?genus=Trachylepis&species=margaritifera) the [world](https://reptile-database.reptarium.cz/species?genus=Plestiodon&species=skiltonianus), so groups of distantly related species may look the same, a feature of evolution called convergence. While they can typically tell each other apart, closely related species can also look very similar with only subtle physical differences that humans have picked up on. For example, Southeastern North America has three sympatric lizards with juvenile forms sporting five yellow lines and a bright blue tail. The official common name for *Plestiodon laticeps* is Broadheaded Skink, *P. inexpectatus* is Southeastern Five-lined Skink and *P. fasciatus* is Five-lined Skink. *P. laticeps* would have 5 labial scales, *P. inexpectatus* and *P.fasciatus* have four. If you're trying to distinguish inexpectatus from fasciatus you have to then move on to the [scales around the vent](https://www.virginiaherpetologicalsociety.com/reptiles/lizards/southeastern-five-lined-skink/fivelinedskinks_tail.jpg). It helps to be discrete when speaking of these taxa; many aren't aware of the subtleties in natural history."},
     {'command': "glass", 'text': "Often confused with snakes, there are a [number of harmless limbless lizards with long fracturing tails](https://reptile-database.reptarium.cz/advanced_search?taxon=Anguinae&submit=Search) used as anti-predator devices. When seized, the tails shatter - hence the 'glass' namesnake. The most commonly encountered and asked about species, especially in Florida, is the Eastern Glass Lizard *Ophisaurus ventralis*. It has no pigment below a ridge along its side called a lateral groove. In Europe, the Slow Worm *Anguis fragilis* species complex is frequently observed in gardens and around homes. [Phylogenetics](https://doi.org/10.1016/j.ympev.2018.12.022)"},
	{'command': "rhyme", 'text': "The traditional color-based rhyme for coralsnakes isn't recommended as an identification trick as it isn't foolproof and only applies to snakes that live in parts of North America. See [this summary](http://thevenominterviews.com/2016/06/02/mythbusting-coral-snakes/) compiled by our own /u/RayInLA for more. It's far more advantageous to familiarize yourself with venomous snakes in your area through photos and field guides or by following subreddits like /r/whatsthissnake than it is to try to apply any generic trick."},
	{'command': "hot" or "hots", 'text': "The term used for wild venomous snakes is 'venomous'. Across species, strength of venom is a spectrum, and delivery method is also quite variable. The term 'hot' is pet trade slang and isn't used in biology."},
	{'command': "specificepithet", 'text': "Naming in biology follows a set of conventional rules. A species name has two parts. The first word, always capitalized, is the 'genus'. Take for example the Bushmaster, *Lachesis muta*. 'Lachesis' is the genus, a group of at least four charismatic, venomous, egg-laying pit vipers native to Central and South America. The second part, in our case 'muta', is the 'specific epithet', and is never capitalized. This particular specific epithet is 'muta' as in muteness, a reference to the this pit viper's rattle-less tail. With its granular, raised scales, the Bushmaster is reminiscent of a mute rattlesnake. The two words together form the species name, *Lachesis muta*. This name is also a species hypothesis about who is related to who - taxonomy reflects the evolutionary history of the group."},
	{'command': "harmless", 'text': "Like many other animals with mouths and teeth, non-venomous snakes can use them to bite in self defense. These animals are referred to as 'not medically significant' or traditionally, 'harmless'. Bites from these snakes benefit from being washed and kept clean like any other skin damage, but aren't often cause for anything other than basic first aid treatment. Some snakes use venom from front or rear fangs as part of prey capture and defense. This venom is not always produced or administered  by the snake in ways dangerous to human health, so many species are venomous in that they produce venom, but considered harmless to humans in most cases because the venom is of low potency, and/or otherwise administered through grooved rear teeth or simply oozed from ducts at the rear of the mouth. Species like Ringneck Snakes *Diadophis* are a good example of mildly venomous rear fanged dipsadine snakes that are traditionally considered harmless or not medically significant. Many rear-fanged snake species are harmless as long as they do not have a chance to secrete a medically significant amount of venom into a bite; [severe envenomation can occur](https://pubmed.ncbi.nlm.nih.gov/23800999) if some species are [allowed to chew on a human](https://www.sciencedirect.com/science/article/abs/pii/S004101011831016X) for as little as 30-60 seconds. It is best not to fear snakes, but use common sense and do not let any animals chew on exposed parts of your body. Similarly, but without specialized rear fangs, gartersnakes *Thamnophis* ooze low pressure venom from the rear of their mouth that helps in prey handling, and are also [considered harmless](https://cityroom.blogs.nytimes.com/2012/06/05/theres-no-need-to-fear-that-garter-snake/). Even large species such as *Malayopython reticulatus* [rarely obtain a size large enough to endanger humans](https://www.pnas.org/content/pnas/108/52/E1470.full.pdf) so are usually categorized as harmless."},
	{'command': "schools", 'text': "https://ssarherps.org/all-about-herps/how-to-be-a-herpetologist/"  +"\n\n"+ "https://ssarherps.org/2021/04/tool-to-connect-herpetologically-minded-labs-with-prospective-students-and-postdocs/"},
	{'command': "ecdysis", 'text': "Snakes undergo a process called shedding or 'ecdysis' where old skin is shed in favor of a new, fresh layer of scales. During this process the old skin becomes dull, the belly may turn pink, and the eyes turn mostly opaque blue due to a build-up of fluid between the old and new spectacle. A few days before the skin is physically sloughed, the eyes become clear. When it comes time to shed, the snake will push or rub up against objects in the environment to hook the old skin on something and unroll it off of them like taking off a sock."},
	{'command': "snakehole" or "snakeholes", 'text': "Snakes do not typically dig their own permanent burrows, tunnels or holes, instead using burrows from other animals or existing spaces between substrate. Snakes enter burrows and consume residents but the idea of a 'snake hole' is mostly a myth."},
	{'command': "about" or "help", 'text': "I am a bot created to help out here in /r/whatsthissnake. /u/Phylogenizer set me up with the goals of increasing the amount of information conveyed to people asking for identification help, to assist those interested in snake evolution and biogeography (SEB) in quickly accessing the most recent scientific publications concerning phylogeography and phylogenomics and to provide consistent up to date taxonomic information. Since my original debut here in /r/whatsthissnake in August 2018 (happy cakeday to me), I've expanded my functionality to /r/Herpetology, /r/Snakes, /r/Sneks and /r/Reptiles." +"\n\n"+ "At my core, I am a keyword bot. One of my main functions is to reply with short species accounts of identified snakes. These species accounts are written by users of this subreddit - right now we're prioritizing information on North American species, as this is where more of our submissions come from. If you'd like to write a short species account, especially for species outside of North America, I invite you to submit your accounts to me using a [www.pastebin.com](https://www.pastebin.com) link in a private message. My species accounts are saved in text files and use the standard 'old reddit' markup characters. /u/Phylogenizer edits them to help curate and provide consistency. If you see anything wrong in an account, blame him not me, but do send a quick PM with your correction - we'll fix it."  +"\n\n"+ "My second main function is to reply to commands given by users, to invoke vetted information on snakes. These commands are useful and tailored to frequently asked questions in the subreddit. Commands are preceded by an exclamation point - you can see the full list below. If there's something you'd like to change or add, feel free to comment below and we'll try to work it in to the next update."  +"\n\n"+ "I am NOT a verification bot - just because you see me reply to a user does not mean I endorse that ID. I respond to anyone and everyone in my core subreddits (/r/Herpetology, /r/WhatsThisSnake, /r/Snakes) and to select commenters from these subreddits wherever they go on Reddit." +"\n\n"+ "I also do some of the more monotonous tasks - for example, I can tell if someone has provided a geographic location properly, and if they haven't, I ask them, within thirty seconds of their post, to provide it and I explain why it is important - no humans needed. I also automatically reply to posts with the 'Dead Snake' flair to include some basic information on why killing snakes is not favorable. We save a lot of time and energy with this automation."  +"\n\n"+ "I concatenate responses and posts replies as a single comment. Nifty eh? You can use multiple commands and species names, and the bot won't clutter up the thread with a comment for each. This also applies to those of you the bot follows outside of the home subreddits. Where once it crashed the bot, now you are freed. It even puts a little line between entries. You're now only limited by how many characters a Reddit response can be. In the future, I hope to be able to respond automatically to much more. I'm still a baby in development. I will go up, down, and I will probably break a few times. Please be patient with me, and don't forget, you can help by writing well-sourced species accounts **in your own words** for species not on the list below." +"\n\n"+ "Thanks!" +"\n\n"+ "PhyloBot" +"\n\n"+ "PS - I am written in Python." +"\n\n"+ "\*\*\*" +"\n\n"+ "**Features in v0.7:**" +"\n\n"+ "**Current List of Commands** - anyone should be able to use these in the home subreddits of /r/Herpetology, /r/Snakes, /r/WhatsThisSnake, /r/Reptiles and /r/Sneks. The current, full list of commands is:" +"\n\n"+ "**!deadsnake** - Invokes the information from the dead snake auto response"+"\n\n"+ "**!myths** - Provides a list of common snake myths ( in development - send me your favorite with a high quality link to a source refuting it and I'll put it in!)"+"\n\n"+ "**!poisonous** or **!venomous** - Provides information on the definitions of venomous and poisonous as they relate to snakes" +"\n\n"+ "**!keels** - Provides information on snake scale architecture." +"\n\n"+ "**!cats** - Provides information on outdoor cats, one of the largest threats to wildlife worldwide." +"\n\n"+ "**!shed** - Provides basic information and resources on identifying a snake from a shed skin." +"\n\n"+ "**!blackrat** - Provides a basic rundown of why you might hear the term 'black ratsnake' and why, as an enlightened individual, you don't repeat it." +"\n\n"+ "**!resources** - Provides a basic list of resources for worldwide snake identification" +"\n\n"+ "**!gluetrap** - Provides information on gluetraps and how to get snakes unstuck" +"\n\n"+ "**!location** - Invokes the 'location needed' message from the auto response on /r/whatsthissnake" +"\n\n"+ "**!wildpet** - Provides information on why keeping wild snakes as pets isn't usually a good idea, even if they come from a pet store." +"\n\n"+ "**!aggressive** or **!defensive** - Rebuttal to the commonly misunderstood defensive posturing in snakes." +"\n\n"+ "**!headshape** - Explanation of how head shape isn't a reliable indication of if a snake is venomous" +"\n\n"+ "**!rhyme** - A specific response to the 'red touches yellow, kill a fellow' rhyme." +"\n\n"+ "**!hot** - Provides information on best practices in biological terminology of venomous snakes." +"\n\n"+ "**!specificepithet** - Explains species names and their formatting. Uses an example, but not snake specific." +"\n\n"+ "**!harmless** - An explanation of the word harmless and how the category does indeed include species that bite in self defense." +"\n\n"+ "**!ecdysis** - Provides information on the shedding process, needs to be expanded." +"\n\n"+ "**!snakehole** - Info on how snakes don't dig their own burrows" +"\n\n"+ "**!fiveline** - Info on commonly confused skinks with yellow lines and blue tails" +"\n\n"+ "**!pool** - Provides information on mitigating pools as wildlife sinks"},
	{'command': "pool" or "pools", 'text': "Snakes and other creatures often fall victim to the aquatic pitfall traps that are pools, hot tubs and human constructed ponds. Several inexpensive products can reduce the amount of native wildlife killed. Among the most popular are the [Frog Log](https://www.amazon.com/s?k=frog+log) and the [Critter Skimmer](https://www.amazon.com/Critter-Skimmer-10-Inch-Square-Cover/dp/B003G30FJE/)."},

]

specieslist = []
with open('species.txt', 'r') as filehandle:
	for line in filehandle:
		specieslist.append(line.strip())


def bot_login():
	print("Logging in...")
	r = praw.Reddit(username=config.username,
	                password=config.password,
	                client_id=config.client_id,
	                client_secret=config.client_secret,
	                user_agent="phylohelper v0.1")
	print("Logged in!")

	return r


def checkComment(comment):
	if comment.saved or comment.author == r.user.me() or datetime.utcfromtimestamp(comment.created_utc) < startTime:
		return
	bldr = [] # create an empty array


	for species in specieslist:
		if "*" + species + "*" in comment.body:
			print("String with \"+ species""\" found in comment " + comment.id)
			with open(species + ".txt", "r") as f:
				comment_reply = f.read()
				bldr.append(comment_reply)
				print("Replied to comment " + comment.id)

	for command in commands:
		if "!" + command['command'] in comment.body:
			print("!" + command['command'] + " found in comment " + comment.id)
			bldr.append(command['text']) ##was comment.reply(command['text'] + "\n\n" + sig)
	if len(bldr): # if we have appended anything to bldr
		bldr.append(sig) # add the signature at the end
		comment.reply("\n\n--------------------------------------------------------\n\n".join(bldr)) # take each of the replies we put in the list, separate them with the double newline, and reply to the comment
	comment.save()


def run_bot(r):
	print("Obtaining 10 comments...")

	for username in list_of_names:
		user = r.redditor(username)
		for comment in user.comments.new(limit=10):
			checkComment(comment)

	for comment in r.subreddit('whatsthissnake+herpetology+snakes+reptiles+sneks+wvzphotos').comments(limit=10): ###'whatsthissnake+herpetology+snakes'
		checkComment(comment)

	for submission in r.subreddit('whatsthissnake').new(limit=10): ##change to test 'whatsthissnake'
		if submission.saved or submission.author == r.user.me() or datetime.utcfromtimestamp(submission.created_utc) < startTime:
			break

		if len(re.findall('\[.+\]', submission.title)) == 0:
			submission.reply("It looks like you didn't provide a rough geographic location [in square brackets] in your title. "
			                 "Some species are best distinguishable from each other by geographic range, and not all "
			                 "species live all places. Providing a location allows for a quicker, more accurate ID."
			                 + "\n\n" + "If you provided a location but forgot the correct brackets, ignore this message "
			                            "until your next submission. Thanks!" + "\n\n" + sig)
			print("Replied to submission " + submission.id)

		if submission.link_flair_text == "Dead, Injured or Roadkilled Snake":
			submission.reply("This automatic message accompanies any image of a dead, injured or roadkilled snake: " + "\n\n" +
			                 "Please don't kill snakes - they are a natural part of the ecosystem and [even species that "
			                 "use venom for prey acquisition and defense are beneficial to humans]"
			                 "(https://web.archive.org/web/20180802190346/https://umdrightnow.umd.edu/news/timber-rattlesnakes-vs-lyme-disease). One cannot expect "
			                 "outside to be sterile - if you see a snake you're in or around their preferred habitat. "
			                 "Most snakes are valued and as such are protected from collection, killing or harassment "
			                 "as non-game animals at the state level.\n\n[Neighborhood dogs]"
			                 "(http://livingalongsidewildlife.com/?p=3141) "
			                 "are more likely to harm people. Professional snake relocation services are often free or "
			                 "inexpensive, but snakes often die trying to return to their original home range, so it is "
			                 "usually best to enjoy them like you would songbirds or any of the other amazing wildlife "
			                 "native to your area. Commercial snake repellents are not effective - to discourage snakes, "
			                 "eliminate sources of food and cover; clear debris, stacked wood and eliminate rodent "
			                 "populations. Seal up cracks in and around the foundation/base of your home." + "\n\n" + sig)
			print("Replied to Dead Snake flair - " + submission.id)

		submission.save()
		
	for submission in r.subreddit('Herpetology').new(limit=10): ##change to test 'whatsthissnake'
		if submission.saved or submission.author == r.user.me() or datetime.utcfromtimestamp(submission.created_utc) < startTime:
			break

		if submission.link_flair_text == "Herpetoculture":
			submission.reply("Herpetology is the study of reptiles and amphibians. This post has been marked by the original poster as herpetoculture, which is the keeping of reptiles and amphibians in captivity. Herpetoculture posts are not suitable for /r/Herpetology and your post will be removed shortly. There are many suitable locations to post a pet or ask for pet care help, including /r/Herpetoculture and /r/Reptiles" + "\n\n" + "If you applied this flair in error, for example to a photo of an animal in the wild, please clear it." + "\n\n" + sig)
			print("Replied to Herpetoculture flair - " + submission.id)

		submission.save()


r = bot_login()

while True:
	try:
		run_bot(r)
	except Exception as err:
		print("Hit an error in main loop")
		print(traceback.format_exc())

	print("Sleeping for 30 seconds...")
	time.sleep(30)